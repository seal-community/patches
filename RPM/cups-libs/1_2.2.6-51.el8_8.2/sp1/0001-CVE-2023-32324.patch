From d3f9e0d45000e70366df87268ac47e8012f7db67 Mon Sep 17 00:00:00 2001
From: Seal <info@seal.security>
Date: Tue, 14 Nov 2023 10:41:35 +0000
Subject: [PATCH 1/3] Seal Security Hotfix for cups-libs 1:2.2.6-51.el8_8.2

This patch fixes:
  CVE-2023-32324

For more information see:
  1. https://seal.security
  2. https://github.com/seal-community
  3. https://git.almalinux.org/rpms/cups/releases/tag/imports/c8/cups-2.2.6-51.el8_8.2
---
 SOURCES/CVE-2023-32324.patch | 23 +++++++++++++++++++++++
 SPECS/cups.spec              |  5 +++++
 2 files changed, 28 insertions(+)
 create mode 100644 SOURCES/CVE-2023-32324.patch

diff --git a/SOURCES/CVE-2023-32324.patch b/SOURCES/CVE-2023-32324.patch
new file mode 100644
index 0000000..fb8e663
--- /dev/null
+++ b/SOURCES/CVE-2023-32324.patch
@@ -0,0 +1,23 @@
+diff --up a/cups/string.c b/cups/string.c
+index 93cdad19d..6ef585154 100644
+--- a/cups/string.c
++++ b/cups/string.c
+@@ -1,6 +1,7 @@
+ /*
+  * String functions for CUPS.
+  *
++ * Copyright 2023 by OpenPrinting.
+  * Copyright 2007-2014 by Apple Inc.
+  * Copyright 1997-2007 by Easy Software Products.
+  *
+@@ -730,6 +731,9 @@ _cups_strlcpy(char       *dst,		/* O - Destination string */
+   size_t	srclen;			/* Length of source string */
+ 
+ 
++  if (size == 0)
++    return (0);
++
+  /*
+   * Figure out how much room is needed...
+   */
+
diff --git a/SPECS/cups.spec b/SPECS/cups.spec
index 2871fbe..1742b58 100644
--- a/SPECS/cups.spec
+++ b/SPECS/cups.spec
@@ -154,6 +154,9 @@ Patch78: 0001-Update-man-pages-for-h-option-Issue-357.patch
 Patch79: cups-kerberos.patch
 # CVE-2023-32360 cups:  Information leak through Cups-Get-Document operation
 Patch80: 0001-Require-authentication-for-CUPS-Get-Document.patch
+# CVE-2023-32324 A flaw was found in the Cups package. A buffer overflow vulnerability in the |format_log_line| function could allow remote attackers to cause a denial of service. Exploitation is only possible when the configuration file, cupsd.conf, has the value of loglevel set to DEBUG.
+Patch81: CVE-2023-32324.patch
+
 
 Patch1000: cups-lspp.patch
 
@@ -445,6 +448,8 @@ Sends IPP requests to the specified URI and tests and/or displays the results.
 %patch79 -p1 -b .kerberos
 # CVE-2023-32360 cups: Information leak through Cups-Get-Document operation
 %patch80 -p1 -b .get-document-auth
+# CVE-2023-32324
+%patch81 -p1 -b .cve32324
 
 sed -i -e '1iMaxLogSize 0' conf/cupsd.conf.in
 
-- 
2.39.3

