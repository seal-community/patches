From e644aa1b905a100898eda6bcd5c32a9bfa15f704 Mon Sep 17 00:00:00 2001
From: Seal <info@seal.security>
Date: Tue, 5 Dec 2023 11:43:33 +0200
Subject: [PATCH 2/2] Seal Security Hotfix for screen 4.1.0-0.27.20120314git3c2946.el7_9

This patch fixes:
  CVE-2023-24626

For more information see:
  1. https://seal.security
  2. https://github.com/seal-community
  3. https://git.centos.org/rpms/screen/tree/542a4ef0c59a21844e513434101fd6dae28d133d
---
 src/socket.c | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/src/socket.c b/src/socket.c
index 8f9a315..7bb335a 100644
--- a/src/socket.c
+++ b/src/socket.c
@@ -1188,8 +1188,13 @@ ReceiveMsg()
 	  else
 	    queryflag = -1;
 
-	  Kill(m.m.command.apid, (queryflag >= 0) ? SIGCONT : SIG_BYE);	/* Send SIG_BYE if an error happened */
-	  queryflag = -1;
+	  if (CheckPid(m.m.command.apid)) {
+	    Msg(0, "Query attempt with bad pid(%d)!", m.m.command.apid);
+	  }
+	  else {
+	    Kill(m.m.command.apid, (queryflag >= 0) ? SIGCONT : SIG_BYE); /* Send SIG_BYE if an error happened */
+	    queryflag = -1;
+	  }
 	}
       break;
     case MSG_COMMAND:
-- 

