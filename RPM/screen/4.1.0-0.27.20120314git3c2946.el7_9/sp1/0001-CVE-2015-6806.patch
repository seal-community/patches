From b7484c224738247b510ed0d268cd577076958f1b Mon Sep 17 00:00:00 2001
From: Seal <info@seal.security>
Date: Mon, 31 Aug 2015 17:49:57 +0000
Subject: [PATCH 1/2] Seal Security Hotfix for screen 4.1.0-0.27.20120314git3c2946.el7_9

This patch fixes:
  CVE-2015-6806

For more information see:
  1. https://seal.security
  2. https://github.com/seal-community
  3. https://git.centos.org/rpms/screen/tree/542a4ef0c59a21844e513434101fd6dae28d133d
---
 src/ansi.c | 14 +++++++-------
 1 file changed, 7 insertions(+), 7 deletions(-)

diff --git a/src/ansi.c b/src/ansi.c
index a342fb1..152d2ef 100644
--- a/src/ansi.c
+++ b/src/ansi.c
@@ -2502,13 +2502,13 @@ int n, ys, ye, bce;
     return;
   if (n > 0)
     {
+      if (ye - ys + 1 < n)
+	n = ye - ys + 1;
       if (n > 256)
 	{
 	  MScrollV(p, n - 256, ys, ye, bce);
 	  n = 256;
 	}
-      if (ye - ys + 1 < n)
-	n = ye - ys + 1;
 #ifdef COPY_PASTE
       if (compacthist)
 	{
@@ -2562,14 +2562,14 @@ int n, ys, ye, bce;
     }
   else
     {
-      if (n < -256)
-	{
-	  MScrollV(p, n + 256, ys, ye, bce);
-	  n = -256;
-	}
       n = -n;
       if (ye - ys + 1 < n)
 	n = ye - ys + 1;
+      if (n > 256)
+	{
+	  MScrollV(p, - (n - 256), ys, ye, bce);
+	  n = 256;
+	}
 
       ml = p->w_mlines + ye;
       /* Clear lines */
-- 

