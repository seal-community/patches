From 1089f4c3057a0171b0ae3abc90ba9a6d4a2a7e18 Mon Sep 17 00:00:00 2001
From: Seal <info@seal.security>
Date: Thu, 21 Dec 2023 14:11:50 +0200
Subject: [PATCH 1/1] Seal Security Hotfix for c-ares 1.10.0-3.el7

This patch fixes:
  CVE-2022-4904

For more information see:
  1. https://seal.security
  2. https://github.com/seal-community
  3. https://git.centos.org/rpms/c-ares/tree/be2d780e2f1ed339cfcab9cf9560ef6732d4d5fe
---
 ares_init.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/ares_init.c b/ares_init.c
index d23c1b0..827ed4d 100644
--- a/ares_init.c
+++ b/ares_init.c
@@ -1592,6 +1592,8 @@ static int config_sortlist(struct apattern **sortlist, int *nsort,
       q = str;
       while (*q && *q != '/' && *q != ';' && !ISSPACE(*q))
         q++;
+      if (q-str >= 16)
+        return ARES_EBADSTR;
       memcpy(ipbuf, str, q-str);
       ipbuf[q-str] = '\0';
       /* Find the prefix */
@@ -1600,6 +1602,8 @@ static int config_sortlist(struct apattern **sortlist, int *nsort,
           const char *str2 = q+1;
           while (*q && *q != ';' && !ISSPACE(*q))
             q++;
+          if (q-str >= 32)
+            return ARES_EBADSTR;
           memcpy(ipbufpfx, str, q-str);
           ipbufpfx[q-str] = '\0';
           str = str2;
-- 

