From 5bf59239596537a3ef8f934b8ab8b7233542d958 Mon Sep 17 00:00:00 2001
From: Seal <info@seal.security>
Date: Sun, 10 Mar 2024 15:46:21 +0200
Subject: [PATCH 1/2] Seal Security Hotfix for loader-utils 2.0.0

This patch fixes:
  CVE-2022-37599
  CVE-2022-37603

For more information see:
  1. https://seal.security
  2. https://github.com/seal-community
  3. https://github.com/webpack/loader-utils/tree/v2.0.0
---
 lib/interpolateName.js       |  2 +-
 test/interpolateName.test.js | 21 +++++++++++++++++++++
 2 files changed, 22 insertions(+), 1 deletion(-)

diff --git a/lib/interpolateName.js b/lib/interpolateName.js
index 6a13a36..0cd3932 100644
--- a/lib/interpolateName.js
+++ b/lib/interpolateName.js
@@ -108,7 +108,7 @@ function interpolateName(loaderContext, name, options) {
       // `hash` and `contenthash` are same in `loader-utils` context
       // let's keep `hash` for backward compatibility
       .replace(
-        /\[(?:([^:\]]+):)?(?:hash|contenthash)(?::([a-z]+\d*))?(?::(\d+))?\]/gi,
+        /\[(?:([^[:\]]+):)?(?:hash|contenthash)(?::([a-z]+\d*))?(?::(\d+))?\]/gi,
         (all, hashType, digestType, maxLength) =>
           getHashDigest(content, hashType, digestType, parseInt(maxLength, 10))
       )
diff --git a/test/interpolateName.test.js b/test/interpolateName.test.js
index 9f31464..a7a9d80 100644
--- a/test/interpolateName.test.js
+++ b/test/interpolateName.test.js
@@ -381,4 +381,25 @@ describe('interpolateName()', () => {
       'should support regExp in options',
     ],
   ]);
+
+  describe('redos interpolate', () => {
+    // Setting timeout for all tests within this describe block
+    it('should evaluate regex in less then 2 sec', () => {
+      const poc = [
+        '/absolute/path/to/app/js/javascript.js',
+        '[E'.repeat(387300) + '[HASH]',
+        'test content',
+        '[E'.repeat(387300) + 'a69899814931280e2f527219ad6ac754',
+      ];
+      const time = Date.now();
+      const interpolatedName = loaderUtils.interpolateName(
+        { resourcePath: poc[0] },
+        poc[1],
+        { content: poc[2] }
+      );
+      const time_cost = Date.now() - time;
+      expect(time_cost).toBeLessThan(2000);
+      expect(interpolatedName).toBe(poc[3]);
+    });
+  });
 });
-- 


