From 7ddf78726223c1606d7a6aa6b77777bf78f741c6 Mon Sep 17 00:00:00 2001
From: Seal <info@seal.security>
Date: Sun, 10 Mar 2024 13:36:16 +0200
Subject: [PATCH 1/1] Seal Security Hotfix for loader-utils 3.2.0

This patch fixes:
  CVE-2022-37599
  CVE-2022-37603

For more information see:
  1. https://seal.security
  2. https://github.com/seal-community
  3. https://github.com/webpack/loader-utils/tree/v3.2.0
---
 lib/interpolateName.js       |  2 +-
 test/interpolateName.test.js | 20 ++++++++++++++++++++
 2 files changed, 21 insertions(+), 1 deletion(-)

diff --git a/lib/interpolateName.js b/lib/interpolateName.js
index 71999c2..267dd2c 100644
--- a/lib/interpolateName.js
+++ b/lib/interpolateName.js
@@ -76,7 +76,7 @@ function interpolateName(loaderContext, name, options = {}) {
       // `hash` and `contenthash` are same in `loader-utils` context
       // let's keep `hash` for backward compatibility
       .replace(
-        /\[(?:([^:\]]+):)?(?:hash|contenthash)(?::([a-z]+\d*))?(?::(\d+))?\]/gi,
+        /\[(?:([^[:\]]+):)?(?:hash|contenthash)(?::([a-z]+\d*))?(?::(\d+))?\]/gi,
         (all, hashType, digestType, maxLength) =>
           getHashDigest(content, hashType, digestType, parseInt(maxLength, 10))
       );
diff --git a/test/interpolateName.test.js b/test/interpolateName.test.js
index d84bf8e..00301e6 100644
--- a/test/interpolateName.test.js
+++ b/test/interpolateName.test.js
@@ -349,4 +349,24 @@ describe("interpolateName()", () => {
       "should support regExp in options",
     ],
   ]);
+
+  describe("redos interpolate", () => {
+    it("should evaluate regex in less then 2 sec", () => {
+      const poc = [
+        "/absolute/path/to/app/js/javascript.js",
+        "[E".repeat(387300) + "[HASH]",
+        "test content",
+        "[E".repeat(387300) + "0e6882304e9adbd5",
+      ];
+      const time = Date.now();
+      const interpolatedName = loaderUtils.interpolateName(
+        { resourcePath: poc[0] },
+        poc[1],
+        { content: poc[2] }
+      );
+      const time_cost = Date.now() - time;
+      expect(time_cost).toBeLessThan(2000);
+      expect(interpolatedName).toBe(poc[3]);
+    });
+  });
 });
-- 


