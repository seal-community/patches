From ff6042b2e5dd86c3c70a8d8a4503fe266d9ead0e Mon Sep 17 00:00:00 2001
From: Seal <info@seal.security>
Date: Sun, 21 Jan 2024 17:46:42 +0200
Subject: [PATCH 1/1] Seal Security Hotfix for @babel/traverse 7.21.5

This patch fixes:
  CVE-2023-45133

For more information see:
  1. https://seal.security
  2. https://github.com/seal-community
  3. https://github.com/babel/babel/tree/v7.21.5
---
 packages/babel-traverse/src/path/evaluation.ts | 7 +++++--
 packages/babel-traverse/test/evaluation.js     | 6 +++++-
 2 files changed, 10 insertions(+), 3 deletions(-)

diff --git a/packages/babel-traverse/src/path/evaluation.ts b/packages/babel-traverse/src/path/evaluation.ts
index c4a39df798..f7f3f48e56 100644
--- a/packages/babel-traverse/src/path/evaluation.ts
+++ b/packages/babel-traverse/src/path/evaluation.ts
@@ -419,8 +419,11 @@ function _evaluate(path: NodePath, state: State): any {
         !isInvalidMethod(property.node.name)
       ) {
         context = global[object.node.name];
-        // @ts-expect-error property may not exist in context object
-        func = context[property.node.name];
+        const key = property.node.name;
+        // TODO(Babel 8): Use Object.hasOwn
+        if (Object.hasOwnProperty.call(context, key)) {
+          func = context[key as keyof typeof context];
+        }
       }
 
       // "abc".charCodeAt(4)
diff --git a/packages/babel-traverse/test/evaluation.js b/packages/babel-traverse/test/evaluation.js
index a1e2aadca3..7d1fc2f56f 100644
--- a/packages/babel-traverse/test/evaluation.js
+++ b/packages/babel-traverse/test/evaluation.js
@@ -151,7 +151,11 @@ describe("evaluation", function () {
     expect(eval_member_expr.value).toBe(2);
     expect(eval_invalid_call.confident).toBe(false);
   });
-
+  it("should not evaluate inherited methods", function () {
+    const path = getPath("Math.hasOwnProperty('min')");
+    const evalResult = path.get("body.0.expression").evaluate();
+    expect(evalResult.confident).toBe(false);
+  });
   it("should not deopt vars in different scope", function () {
     const input =
       "var a = 5; function x() { var a = 5; var b = a + 1; } var b = a + 2";
-- 


