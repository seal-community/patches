From ef91386ec74a427d6bd8bf43f2b4339137505648 Mon Sep 17 00:00:00 2001
From: Seal <info@seal.security>
Date: Wed, 20 Sep 2023 18:13:44 +0300
Subject: [PATCH 3/3] Seal Security Hotfix for mongoose 5.3.3

This patch fixes:
  CVE-2019-17426

For more information see:
  1. https://seal.security
  2. https://github.com/seal-community
  3. https://github.com/Automattic/mongoose/tree/5.3.3
---
 lib/cast.js | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/lib/cast.js b/lib/cast.js
index 641d6be84..bf38e10e6 100644
--- a/lib/cast.js
+++ b/lib/cast.js
@@ -27,6 +27,12 @@ module.exports = function cast(schema, obj, options, context) {
     throw new Error('Query filter must be an object, got an array ', util.inspect(obj));
   }
 
+  // bson 1.x has the unfortunate tendency to remove filters that have a top-level
+  // `_bsontype` property. Should remove this when we upgrade to bson 4.x. See gh-8222
+  if (obj.hasOwnProperty('_bsontype')) {
+    delete obj._bsontype;
+  }
+
   const paths = Object.keys(obj);
   let i = paths.length;
   let _keys;
-- 
2.39.3 (Apple Git-145)

