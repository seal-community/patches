From 956344e39b79fe142487a1eb1c667a7db59ab2b6 Mon Sep 17 00:00:00 2001
From: Seal <info@seal.security>
Date: Tue, 3 Oct 2023 18:13:11 +0300
Subject: [PATCH 1/1] Seal Security Hotfix for postcss 7.0.39

This patch fixes:
  CVE-2023-44270

For more information see:
  1. https://seal.security
  2. https://github.com/seal-community
  3. https://github.com/postcss/postcss/tree/7.0.39
---
 lib/tokenize.es6   | 2 +-
 test/parse.test.js | 6 ++++++
 2 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/lib/tokenize.es6 b/lib/tokenize.es6
index 934281a3..049069bb 100644
--- a/lib/tokenize.es6
+++ b/lib/tokenize.es6
@@ -20,7 +20,7 @@ const AT = '@'.charCodeAt(0)
 
 const RE_AT_END = /[ \n\t\r\f{}()'"\\;/[\]#]/g
 const RE_WORD_END = /[ \n\t\r\f(){}:;@!'"\\\][#]|\/(?=\*)/g
-const RE_BAD_BRACKET = /.[\\/("'\n]/
+const RE_BAD_BRACKET = /.[\\/("'\r\n]/
 const RE_HEX_ESCAPE = /[a-f0-9]/i
 
 export default function tokenizer (input, options = {}) {
diff --git a/test/parse.test.js b/test/parse.test.js
index 0cca893a..9e84daf6 100644
--- a/test/parse.test.js
+++ b/test/parse.test.js
@@ -34,6 +34,12 @@ it('should has false at `hasBOM` property', () => {
   expect(css.first.source.input.hasBOM).toBeFalsy()
 })
 
+it('parses carrier return', () => {
+  expect(() => {
+    parse('@font-face{ font:(\r/*);} body { a: "a*/)} a{}"}')
+  }).toThrowError(/:2:27: Unclosed string/)
+})
+
 it('saves source file', () => {
   let css = parse('a {}', { from: 'a.css' })
   expect(css.first.source.input.css).toEqual('a {}')
-- 
2.39.3

