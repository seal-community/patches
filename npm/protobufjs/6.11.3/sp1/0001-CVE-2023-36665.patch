From eb86779d27e71d389a6b95301ca758de134a41cf Mon Sep 17 00:00:00 2001
From: Seal <info@seal.security>
Date: Wed, 2 Aug 2023 13:08:09 +0300
Subject: [PATCH 1/1] Seal Security Hotfix for protobufjs 6.11.3

This patch fixes:
  CVE-2023-36665

For more information see:
  1. https://seal.security
  2. https://github.com/seal-community
  3. https://github.com/protobufjs/protobuf.js/tree/v6.11.3
---
 src/util.js       | 2 +-
 tests/api_util.js | 9 +++++++++
 2 files changed, 10 insertions(+), 1 deletion(-)

diff --git a/src/util.js b/src/util.js
index c39d33a6..6c508990 100644
--- a/src/util.js
+++ b/src/util.js
@@ -176,7 +176,7 @@ util.decorateEnum = function decorateEnum(object) {
 util.setProperty = function setProperty(dst, path, value) {
     function setProp(dst, path, value) {
         var part = path.shift();
-        if (part === "__proto__") {
+        if (part === "__proto__" || part === "prototype") {
           return dst;
         }
         if (path.length > 0) {
diff --git a/tests/api_util.js b/tests/api_util.js
index 7b6f50ff..63da0170 100644
--- a/tests/api_util.js
+++ b/tests/api_util.js
@@ -95,6 +95,15 @@ tape.test("util", function(test) {
 
         util.setProperty(o, 'prop.subprop', { subsub2: 7});
         test.same(o, {prop1: [5, 6], prop: {subprop: [{subsub: [5,6]}, {subsub2: 7}]}}, "should convert nested properties to array");
+        
+        util.setProperty({}, "__proto__.test", "value");
+        test.is({}.test, undefined);
+
+        util.setProperty({}, "prototype.test", "value");
+        test.is({}.test, undefined);
+
+        util.setProperty({}, "constructor.prototype.test", "value");
+        test.is({}.test, undefined);
 
         test.end();
     });
-- 

