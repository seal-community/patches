From c98284b504afdde76780b72f5601b68ea19abf5d Mon Sep 17 00:00:00 2001
From: Seal <info@seal.security>
Date: Tue, 23 Jan 2024 13:21:32 +0200
Subject: [PATCH 1/1] Seal Security Hotfix for protobufjs 6.10.2

This patch fixes:
  CVE-2022-25878
  CVE-2023-36665

For more information see:
  1. https://seal.security
  2. https://github.com/seal-community
  3. https://github.com/protobufjs/protobuf.js/tree/v6.10.2
---
 src/util.js       | 3 +++
 tests/api_util.js | 8 ++++++++
 2 files changed, 11 insertions(+)

diff --git a/src/util.js b/src/util.js
index 5ae88cc7..c99e69a4 100644
--- a/src/util.js
+++ b/src/util.js
@@ -176,6 +176,9 @@ util.decorateEnum = function decorateEnum(object) {
 util.setProperty = function setProperty(dst, path, value) {
     function setProp(dst, path, value) {
         var part = path.shift();
+        if (part === "__proto__" || part === "prototype") {
+            return dst;
+         }
         if (path.length > 0) {
             dst[part] = setProp(dst[part] || {}, path, value);
         } else {
diff --git a/tests/api_util.js b/tests/api_util.js
index 7b6f50ff..92d6ce29 100644
--- a/tests/api_util.js
+++ b/tests/api_util.js
@@ -95,7 +95,15 @@ tape.test("util", function(test) {
 
         util.setProperty(o, 'prop.subprop', { subsub2: 7});
         test.same(o, {prop1: [5, 6], prop: {subprop: [{subsub: [5,6]}, {subsub2: 7}]}}, "should convert nested properties to array");
+        
+        util.setProperty({}, "__proto__.test", "value");
+        test.is({}.test, undefined);
 
+        util.setProperty({}, "prototype.test", "value");
+        test.is({}.test, undefined);
+
+        util.setProperty({}, "constructor.prototype.test", "value");
+        test.is({}.test, undefined);
         test.end();
     });
 
-- 

