From 15bc636563677650d571e83afcbb968b93aa86ce Mon Sep 17 00:00:00 2001
From: Seal <info@seal.security>
Date: Tue, 6 Feb 2024 18:45:30 +0200
Subject: [PATCH 2/2] Seal Security Hotfix for hoek 2.16.3

This patch fixes:
  CVE-2020-36604

For more information see:
  1. https://seal.security
  2. https://github.com/seal-community
  3. https://github.com/hapijs/hoek/tree/v2.16.3
---
 lib/index.js  | 3 +++
 test/index.js | 9 +++++++++
 2 files changed, 12 insertions(+)

diff --git a/lib/index.js b/lib/index.js
index 611bf92..99906d1 100644
--- a/lib/index.js
+++ b/lib/index.js
@@ -66,6 +66,9 @@ exports.clone = function (obj, seen) {
         var keys = Object.getOwnPropertyNames(obj);
         for (var i = 0, il = keys.length; i < il; ++i) {
             var key = keys[i];
+            if (key === '__proto__') {
+                continue;
+            }
             var descriptor = Object.getOwnPropertyDescriptor(obj, key);
             if (descriptor &&
                 (descriptor.get ||
diff --git a/test/index.js b/test/index.js
index 9eced5b..4111637 100644
--- a/test/index.js
+++ b/test/index.js
@@ -2518,4 +2518,13 @@ describe('shallow()', function (done) {
         expect(shallow.b).to.equal(obj.b);
         done();
     });
+
+    it('prevents prototype poisoning', function (done){
+
+        var a = JSON.parse('{ "__proto__": { "x": 1 } }');
+        expect(a.x).to.not.exist();
+        var b = Hoek.clone(a);
+        expect(b.x).to.not.exist();
+        done();
+    });
 });
-- 


