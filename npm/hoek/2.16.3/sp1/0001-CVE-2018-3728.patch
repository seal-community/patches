From 6096885a6a7cc9c03d1b9b1d92dc8047cd1030a9 Mon Sep 17 00:00:00 2001
From: Seal <info@seal.security>
Date: Tue, 6 Feb 2024 18:41:07 +0200
Subject: [PATCH 1/2] Seal Security Hotfix for hoek 2.16.3

This patch fixes:
  CVE-2018-3728

For more information see:
  1. https://seal.security
  2. https://github.com/seal-community
  3. https://github.com/hapijs/hoek/tree/v2.16.3
---
 lib/index.js  | 3 +++
 test/index.js | 8 ++++++++
 2 files changed, 11 insertions(+)

diff --git a/lib/index.js b/lib/index.js
index 9a5ffe1..611bf92 100644
--- a/lib/index.js
+++ b/lib/index.js
@@ -110,6 +110,9 @@ exports.merge = function (target, source, isNullOverride /* = true */, isMergeAr
     var keys = Object.keys(source);
     for (var k = 0, kl = keys.length; k < kl; ++k) {
         var key = keys[k];
+        if (key === '__proto__') {
+            continue;
+        }
         var value = source[key];
         if (value &&
             typeof value === 'object') {
diff --git a/test/index.js b/test/index.js
index 1e8ef62..9eced5b 100644
--- a/test/index.js
+++ b/test/index.js
@@ -589,6 +589,14 @@ describe('merge()', function () {
         expect(a.x.toString()).to.equal('abc');
         done();
     });
+    it('skips __proto__', function (done) {
+
+        var a = '{ "ok": "value", "__proto__": { "test": "value" } }';
+        var b = Hoek.merge({}, JSON.parse(a));
+        expect(b).to.deep.equal({ ok: 'value' });
+        expect(b.test).to.equal(undefined);
+        done();
+    });
 });
 
 describe('applyToDefaults()', function () {
-- 


