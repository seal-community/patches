From c8201db69a1b2e6c6e948b795fa778e4df027926 Mon Sep 17 00:00:00 2001
From: Seal <info@seal.security>
Date: Wed, 6 Sep 2023 20:48:43 +0300
Subject: [PATCH 1/1] Seal Security Hotfix for trim 0.0.1

This patch fixes:
  CVE-2020-7753

For more information see:
  1. https://seal.security
  2. https://github.com/seal-community
  3. https://github.com/Trott/trim/tree/0.0.1
---
 index.js     | 10 +++++++---
 test/trim.js | 16 ++++++++++++++++
 2 files changed, 23 insertions(+), 3 deletions(-)

diff --git a/index.js b/index.js
index 36e7e5d..fe065a5 100644
--- a/index.js
+++ b/index.js
@@ -3,15 +3,19 @@ exports = module.exports = trim;
 
 function trim(str){
   if (str.trim) return str.trim();
-  return str.replace(/^\s*|\s*$/g, '');
+  return exports.right(exports.left(str));
 }
 
 exports.left = function(str){
   if (str.trimLeft) return str.trimLeft();
-  return str.replace(/^\s*/, '');
+  return str.replace(/^\s\s*/, '');
 };
 
 exports.right = function(str){
   if (str.trimRight) return str.trimRight();
-  return str.replace(/\s*$/, '');
+  var whitespace_pattern = /\s/,
+      i = str.length;
+  while (whitespace_pattern.test(str.charAt(--i)));
+
+  return str.slice(0, i + 1);
 };
diff --git a/test/trim.js b/test/trim.js
index fbe3358..84e2bde 100644
--- a/test/trim.js
+++ b/test/trim.js
@@ -19,3 +19,19 @@ describe('.right(str)', function(){
     trim.right('  foo bar  ').should.equal('  foo bar');
   })
 })
+
+describe('CVE-2020-7753', function(){
+  it('CVE-2020-7753', function(){
+    function build_attack (n) { 
+      var ret = "1";
+      for (var i = 0; i < n; i++) { 
+        ret += " " 
+      } 
+      return ret + "1"; 
+    }
+    var time = Date.now();
+    trim(build_attack(50000));
+    var time_cost = Date.now() - time; 
+    time_cost.should.be.below(1000);
+  })
+});
-- 
2.39.2

