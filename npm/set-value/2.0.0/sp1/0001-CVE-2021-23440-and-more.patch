From cf4be91fe0fb25571d42211097cef8dfcc74b998 Mon Sep 17 00:00:00 2001
From: Seal <info@seal.security>
Date: Sun, 3 Mar 2024 15:13:56 +0200
Subject: [PATCH 1/1] Seal Security Hotfix for set-value 2.0.0

This patch fixes:
  CVE-2019-10747
  CVE-2021-23440

For more information see:
  1. https://seal.security
  2. https://github.com/seal-community
  3. https://github.com/jonschlinkert/set-value/tree/2.0.0
---
 index.js |  6 +++++-
 test.js  | 12 ++++++++++++
 2 files changed, 17 insertions(+), 1 deletion(-)

diff --git a/index.js b/index.js
index 000a77e..987ba3a 100644
--- a/index.js
+++ b/index.js
@@ -25,7 +25,7 @@ module.exports = function(obj, prop, val) {
     return obj;
   }
 
-  var keys = split(prop, {sep: '.', brackets: true});
+  var keys = split(prop, {sep: '.', brackets: true}).filter(isValidKey);
   var len = keys.length;
   var idx = -1;
   var current = obj;
@@ -49,3 +49,7 @@ module.exports = function(obj, prop, val) {
 
   return obj;
 };
+
+function isValidKey(key) {
+  return key !== '__proto__' && key !== 'constructor' && key !== 'prototype';
+}
\ No newline at end of file
diff --git a/test.js b/test.js
index c8b416a..55a6b5c 100644
--- a/test.js
+++ b/test.js
@@ -198,3 +198,15 @@ describe('escaping', function() {
     assert.deepEqual(obj2, { 'e.f': { 'g.h.i': { j: 1 } } });
   });
 });
+
+describe('pollution', function() {
+  it('should not allow to pollut object', function() {
+    set({}, ['__proto__', 'polluted'], 'yes');
+    assert.equal({}.polluted, undefined);
+  });
+
+  it('should not allow to pollut inner keys of object', function() {
+    set({}, ['constructor.prototype.exploit', 'polluted'], 'yes');
+    assert.equal({}.exploit, undefined);
+  });
+});
-- 


