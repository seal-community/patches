From b481cd6f70221ba2f40a2b0e7eeae3d11dc84d56 Mon Sep 17 00:00:00 2001
From: Seal <info@seal.security>
Date: Tue, 26 Mar 2024 14:38:50 +0200
Subject: [PATCH 1/1] Seal Security Hotfix for getobject 0.1.0

This patch fixes:
  CVE-2020-28282

For more information see:
  1. https://seal.security
  2. https://github.com/seal-community
  3. https://github.com/cowboy/node-getobject/tree/v0.1.0
---
 .npmignore             |  1 +
 .travis.yml            |  3 +--
 lib/getobject.js       | 14 ++++++++++++++
 test/namespace_test.js |  8 ++++++++
 4 files changed, 24 insertions(+), 2 deletions(-)
 create mode 100644 .npmignore

diff --git a/.npmignore b/.npmignore
new file mode 100644
index 0000000..2ccbe46
--- /dev/null
+++ b/.npmignore
@@ -0,0 +1 @@
+/node_modules/
diff --git a/.travis.yml b/.travis.yml
index cbace30..227d5a0 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -1,6 +1,5 @@
 language: node_js
 node_js:
-  - "0.8"
   - "0.10"
 before_script:
-  - npm install -g grunt-cli
+  - npm install -g grunt-cli@0.1.1
diff --git a/lib/getobject.js b/lib/getobject.js
index e4006fe..4e6f525 100644
--- a/lib/getobject.js
+++ b/lib/getobject.js
@@ -42,6 +42,20 @@ getobject.get = function(obj, parts, create) {
 getobject.set = function(obj, parts, value) {
   parts = getParts(parts);

+  // Check if '__proto__' exists in parts
+  var found = false;
+  for (var i = 0; i < parts.length; i++) {
+    if (parts[i] === '__proto__') {
+      found = true;
+      break;
+    }
+  }
+
+  if (found) {
+    // do not allow setting of __proto__. See CVE-2020-28282.
+    return;
+  }
+
   var prop = parts.pop();
   obj = getobject.get(obj, parts, true);
   if (obj && typeof obj === 'object') {
diff --git a/test/namespace_test.js b/test/namespace_test.js
index 2e1c2ae..a776b8e 100644
--- a/test/namespace_test.js
+++ b/test/namespace_test.js
@@ -49,3 +49,11 @@ exports.exists = function(test) {
   test.equal(getobject.exists(obj, 'a.b.x'), false, 'nonexistent property should not exist.');
   test.done();
 };
+
+exports.proto = function(test) {
+  var obj = {};
+  test.equal(getobject.exists(obj, 'isAdmin'), false);
+  getobject.set(obj, '__proto__.isAdmin', true);
+  test.equal(getobject.exists(obj, 'isAdmin'), false);
+  test.done();
+};
--
