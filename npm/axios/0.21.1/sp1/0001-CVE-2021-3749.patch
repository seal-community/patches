From 09128b18f915ec70bb0a5bbb2d020fde33b7cd33 Mon Sep 17 00:00:00 2001
From: Seal <info@seal.security>
Date: Tue, 7 Feb 2023 20:58:19 +0200
Subject: [PATCH 1/1] Seal Security Hotfix for axios 0.21.1

This patch fixes:
  CVE-2021-3749

For more information see:
  1. https://seal.security
  2. https://github.com/seal-community
  3. https://github.com/axios/axios/tree/v0.21.1
---
 lib/utils.js                               |  2 +-
 test/unit/regression/Seal-CVE-2021-3749.js | 21 +++++++++++++++++++++
 2 files changed, 22 insertions(+), 1 deletion(-)
 create mode 100644 test/unit/regression/Seal-CVE-2021-3749.js

diff --git a/lib/utils.js b/lib/utils.js
index 83eb1c6..498d0db 100644
--- a/lib/utils.js
+++ b/lib/utils.js
@@ -187,7 +187,7 @@ function isURLSearchParams(val) {
  * @returns {String} The String freed of excess whitespace
  */
 function trim(str) {
-  return str.replace(/^\s*/, '').replace(/\s*$/, '');
+  return str.trim ? str.trim() : str.replace(/^\s+|\s+$/g, '');
 }
 
 /**
diff --git a/test/unit/regression/Seal-CVE-2021-3749.js b/test/unit/regression/Seal-CVE-2021-3749.js
new file mode 100644
index 0000000..7a3f13d
--- /dev/null
+++ b/test/unit/regression/Seal-CVE-2021-3749.js
@@ -0,0 +1,21 @@
+var {trim} = require("../../../lib/utils");
+const assert = require('assert');
+
+describe('Regular expression DOS test', () => {
+  it('regular expression trim does not cause denial of service', async () => {
+    function build_blank (n) {
+      var ret = "1";
+      for (var i = 0; i < n; i++) {
+        ret += " ";
+      }
+      return ret + "1";
+    }
+    var data = build_blank(50000);
+    var time = Date.now();
+    trim(data)
+    var time_cost = Date.now() - time;
+    //console.log("time_cost: " + time_cost)
+
+    assert.ok(time_cost < 20);
+  });
+});
-- 
2.34.1

