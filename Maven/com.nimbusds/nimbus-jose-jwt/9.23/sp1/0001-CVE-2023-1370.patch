From 51e3de8fe6e6bdc4e35a9eb4d1e538e53e8cd3b5 Mon Sep 17 00:00:00 2001
From: Seal <info@seal.security>
Date: Thu, 10 Aug 2023 16:48:57 +0300
Subject: [PATCH 1/1] Seal Security Hotfix for com.nimbusds:nimbus-jose-jwt 9.23

This patch fixes:
  CVE-2023-1370

For more information see:
  1. https://seal.security
  2. https://github.com/seal-community
  3. https://bitbucket.org/connect2id/nimbus-jose-jwt/src/9.23
---
 pom.xml                                                       | 3 ++-
 src/test/java/com/nimbusds/jose/JWSObjectTest.java            | 2 +-
 src/test/java/com/nimbusds/jose/util/JSONObjectUtilsTest.java | 2 +-
 3 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/pom.xml b/pom.xml
index 0caafa42..754c2bb6 100644
--- a/pom.xml
+++ b/pom.xml
@@ -56,7 +56,8 @@
         <dependency>
             <groupId>net.minidev</groupId>
             <artifactId>json-smart</artifactId>
-            <version>2.4.8</version>
+            <!-- Sealed version taken from Seal's Maven repository -->
+            <version>2.4.8+sp1</version>
             <optional>true</optional>
         </dependency>
         <dependency>
diff --git a/src/test/java/com/nimbusds/jose/JWSObjectTest.java b/src/test/java/com/nimbusds/jose/JWSObjectTest.java
index 1194c7ec..b3820f46 100644
--- a/src/test/java/com/nimbusds/jose/JWSObjectTest.java
+++ b/src/test/java/com/nimbusds/jose/JWSObjectTest.java
@@ -178,7 +178,7 @@ public class JWSObjectTest extends TestCase {
 			JWSObject.parse(jws);
 			fail();
 		} catch (ParseException e) {
-			assertEquals("Invalid JWS header: Excessive JSON object and / or array nesting", e.getMessage());
+			assertTrue(e.getMessage().contains("Invalid JSON: Malicious payload, having non natural depths"));
 		}
 	}
 	
diff --git a/src/test/java/com/nimbusds/jose/util/JSONObjectUtilsTest.java b/src/test/java/com/nimbusds/jose/util/JSONObjectUtilsTest.java
index 5a70ef8a..0c09b405 100644
--- a/src/test/java/com/nimbusds/jose/util/JSONObjectUtilsTest.java
+++ b/src/test/java/com/nimbusds/jose/util/JSONObjectUtilsTest.java
@@ -75,7 +75,7 @@ public class JSONObjectUtilsTest extends TestCase {
 			JSONObjectUtils.parse(sb.toString());
 			fail();
 		} catch (ParseException e) {
-			assertEquals("Excessive JSON object and / or array nesting", e.getMessage());
+			assertTrue(e.getMessage().contains("Invalid JSON: Malicious payload, having non natural depths"));
 		}
 	}
 	
-- 

